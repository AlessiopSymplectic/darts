
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Static Covariates &#8212; darts  documentation</title>
    
  <link href="../_static/css/theme.css" rel="stylesheet">
  <link href="../_static/css/index.ff1ffe594081f20da1ef19478df9384b.css" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      

    
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="../_static/css/blank.css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.be7d3bbb2ef33a8344ce.js">

    <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="shortcut icon" href="../_static/docs-favicon.ico"/>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Transfer Learning for Time Series Forecasting with Darts" href="14-transfer-learning.html" />
    <link rel="prev" title="Data (pre) processing using DataTransformer and Pipeline" href="02-data-processing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <div class="container-fluid" id="banner"></div>

    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main"><div class="container-xl">

  <div id="navbar-start">
    
    

<a class="navbar-brand" href="../index.html">
  <img src="../_static/darts-logo-trim.png" class="logo" alt="logo">
</a>


    
  </div>

  <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-collapsible" aria-controls="navbar-collapsible" aria-expanded="false" aria-label="Toggle navigation">
    <span class="navbar-toggler-icon"></span>
  </button>

  
  <div id="navbar-collapsible" class="col-lg-9 collapse navbar-collapse">
    <div id="navbar-center" class="mr-auto">
      
      <div class="navbar-center-item">
        <ul id="navbar-main-elements" class="navbar-nav">
    <li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../README.html">
  Home
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../quickstart/00-quickstart.html">
  Quickstart
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../userguide.html">
  User Guide
 </a>
</li>

<li class="toctree-l1 nav-item">
 <a class="reference internal nav-link" href="../generated_api/darts.html">
  API Reference
 </a>
</li>

<li class="toctree-l1 current active nav-item">
 <a class="reference internal nav-link" href="../examples.html">
  Examples
 </a>
</li>

    
</ul>
      </div>
      
    </div>

    <div id="navbar-end">
      
      <div class="navbar-end-item">
        <ul id="navbar-icon-links" class="navbar-nav" aria-label="Icon Links">
        <li class="nav-item">
          <a class="nav-link" href="https://github.com/unit8co/darts" rel="noopener" target="_blank" title="GitHub">
            <span><i class="fab fa-github-square"></i></span>
            <label class="sr-only">GitHub</label>
          </a>
        </li>
        <li class="nav-item">
          <a class="nav-link" href="https://twitter.com/unit8co" rel="noopener" target="_blank" title="Twitter">
            <span><i class="fab fa-twitter-square"></i></span>
            <label class="sr-only">Twitter</label>
          </a>
        </li>
      </ul>
      </div>
      
    </div>
  </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
            
            <!-- Only show if we have sidebars configured, else just a small margin  -->
            <div class="col-12 col-md-3 bd-sidebar"><form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">
  <div class="bd-toc-item active">
    <ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="01-multi-time-series-and-covariates.html">
   Multiple Time Series, Pre-trained Models and Covariates
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="02-data-processing.html">
   Data (pre) processing using
   <code class="docutils literal notranslate">
    <span class="pre">
     DataTransformer
    </span>
   </code>
   and
   <code class="docutils literal notranslate">
    <span class="pre">
     Pipeline
    </span>
   </code>
  </a>
 </li>
</ul>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Static Covariates
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="14-transfer-learning.html">
   Transfer Learning for Time Series Forecasting with Darts
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="16-hierarchical-reconciliation.html">
   Hierarchical Reconciliation - Example on the Australian Tourism Dataset
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="17-hyperparameter-optimization.html">
   Hyper-parameters Optimization for Electricity Load Forecasting
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="03-FFT-examples.html">
   Fast Fourier Transform Forecasting Model (FFT)
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="04-RNN-examples.html">
   Recurrent Neural Networks Models
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="05-TCN-examples.html">
   Temporal Convolutional Network
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="06-Transformer-examples.html">
   Transformer Model
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="07-NBEATS-examples.html">
   N-BEATS
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="08-DeepAR-examples.html">
   Probabilistic RNN
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="09-DeepTCN-examples.html">
   DeepTCN model
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="13-TFT-examples.html">
   Temporal Fusion Transformer
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="10-Kalman-filter-examples.html">
   Filtering and predicting using the darts filters
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="11-GP-filter-examples.html">
   Filtering and predicting using the Gaussian Process filter
  </a>
 </li>
</ul>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="12-Dynamic-Time-Warping-example.html">
   Dynamic Time Warping (DTW)
  </a>
 </li>
</ul>

  </div>
</nav>
            </div>
            
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
            
              
              <div class="toc-item">
                
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#1.-Defining-static-covariates">
   1. Defining static covariates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#2.-Add-static-covariates-to-an-existing-TimeSeries">
   2. Add static covariates to an existing TimeSeries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#3.-Adding-static-covariates-at-TimeSeries-construction">
   3. Adding static covariates at TimeSeries construction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#Using-static-covariates-with-multiple-TimeSeries">
   Using static covariates with multiple TimeSeries
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#4.-Extract-a-list-of-time-series-by-groups-from-a-DataFrame-using-from_group_dataframe()">
   4. Extract a list of time series by groups from a DataFrame using
   <code class="docutils literal notranslate">
    <span class="pre">
     from_group_dataframe()
    </span>
   </code>
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#5.-Scaling/Encoding/Transforming-static-covariate-data">
   5. Scaling/Encoding/Transforming static covariate data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#6.-Forecasting-example-with-TFTModel-and-static-covariates">
   6. Forecasting example with
   <code class="docutils literal notranslate">
    <span class="pre">
     TFTModel
    </span>
   </code>
   and static covariates
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#6.1-Experiment-setup">
     6.1 Experiment setup
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#6.2-Forecasting-without-static-covariates">
   6.2 Forecasting without static covariates
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#6.3-Forecasting-with-0/1-binary-static-covariates-(numeric)">
   6.3 Forecasting with 0/1 binary static covariates (numeric)
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#6.4-Forecasting-with-categorical-static-covariates">
   6.4 Forecasting with categorical static covariates
  </a>
 </li>
</ul>

</nav>
              </div>
              
              <div class="toc-item">
                
              </div>
              
            
          </div>
          

          
          
            
          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># fix python path if working locally
from utils import fix_pythonpath_if_working_locally

fix_pythonpath_if_working_locally()
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>%load_ext autoreload
%autoreload 2
%matplotlib inline
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt

from darts import TimeSeries

import warnings

warnings.filterwarnings(&quot;ignore&quot;)
import logging

logging.disable(logging.CRITICAL)
</pre></div>
</div>
</div>
<section id="Static-Covariates">
<h1>Static Covariates<a class="headerlink" href="#Static-Covariates" title="Permalink to this headline">¶</a></h1>
<p>Static covariates are characteristics of a time series / constants which do not change over time. When dealing with multiple time series, static covariates can help specific models improve forecasts. Darts’ models will only consider static covariates embedded in the target series (the series for which we want to predict future values) and not past and/or future covariates (external data).</p>
<p>In this tutorial we look at:</p>
<ol class="arabic simple">
<li><p>how to define static covariates (numeric and/or categorical)</p></li>
<li><p>how to add static covariates to an existing <strong>target</strong> series</p></li>
<li><p>how to add static covariates at TimeSeries creation</p></li>
<li><p>how to use TimeSeries.from_group_dataframe() for automatic extraction of TimeSeries with embedded static covariates</p></li>
<li><p>how to scale/transform/encode static covariates embedded in your series</p></li>
<li><p>how to use static covariates with Darts’ models</p></li>
</ol>
<p>We start by generating a multivariate time series with three components <code class="docutils literal notranslate"><span class="pre">[&quot;comp1&quot;,</span> <span class="pre">&quot;comp2&quot;,</span> <span class="pre">&quot;comp3&quot;]</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>np.random.seed(0)
series = TimeSeries.from_times_and_values(
    times=pd.date_range(start=&quot;2020-01-01&quot;, periods=10, freq=&quot;h&quot;),
    values=np.random.random((10, 3)),
    columns=[&quot;comp1&quot;, &quot;comp2&quot;, &quot;comp3&quot;],
)
series.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_4_0.png" src="../_images/examples_15-static-covariates_4_0.png" />
</div>
</div>
<section id="1.-Defining-static-covariates">
<h2>1. Defining static covariates<a class="headerlink" href="#1.-Defining-static-covariates" title="Permalink to this headline">¶</a></h2>
<p>Define your static covariates as a pd.DataFrame where the columns represent the static variables and rows stand for the components of the uni/multivariate <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> they will be added to.</p>
<ul class="simple">
<li><p>The number of rows must either be 1 or equal to the number of components from <code class="docutils literal notranslate"><span class="pre">series</span></code>.</p></li>
<li><p>Using a single row static covariate DataFrame with a multivariate (multi component) <code class="docutils literal notranslate"><span class="pre">series</span></code>, the static covariates will be mapped globally to all components.</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># arbitrary continuous and categorical static covariates (single row)
static_covs_single = pd.DataFrame(data={&quot;cont&quot;: [0], &quot;cat&quot;: [&quot;a&quot;]})
print(static_covs_single)

# multivariate static covariates (multiple components). note that the number of rows matches the number of components of `series`
static_covs_multi = pd.DataFrame(data={&quot;cont&quot;: [0, 2, 1], &quot;cat&quot;: [&quot;a&quot;, &quot;c&quot;, &quot;b&quot;]})
print(static_covs_multi)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
   cont cat
0     0   a
   cont cat
0     0   a
1     2   c
2     1   b
</pre></div></div>
</div>
</section>
<section id="2.-Add-static-covariates-to-an-existing-TimeSeries">
<h2>2. Add static covariates to an existing TimeSeries<a class="headerlink" href="#2.-Add-static-covariates-to-an-existing-TimeSeries" title="Permalink to this headline">¶</a></h2>
<p>Create a new series from an existing TimeSeries with added static covariates using method <code class="docutils literal notranslate"><span class="pre">with_static_covariates()</span></code> (see docs <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.with_static_covariates">here</a>)</p>
<ul class="simple">
<li><p>Single row static covarites with multivariate <code class="docutils literal notranslate"><span class="pre">series</span></code> creates “global_components” which are mapped to all components</p></li>
<li><p>Multi row static covarites with multivariate <code class="docutils literal notranslate"><span class="pre">series</span></code> will be mapped to the component names of <code class="docutils literal notranslate"><span class="pre">series</span></code> (see static covariate index/row names)</p></li>
</ul>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>assert series.static_covariates is None

series_single = series.with_static_covariates(static_covs_single)
print(&quot;Single row static covarites with multivariate `series`&quot;)
print(series_single.static_covariates)

series_multi = series.with_static_covariates(static_covs_multi)
print(&quot;\nMulti row static covarites with multivariate `series`&quot;)
print(series_multi.static_covariates)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Single row static covarites with multivariate `series`
static_covariates  cont cat
global_components   0.0   a

Multi row static covarites with multivariate `series`
static_covariates  cont cat
component
comp1               0.0   a
comp2               2.0   c
comp3               1.0   b
</pre></div></div>
</div>
</section>
<section id="3.-Adding-static-covariates-at-TimeSeries-construction">
<h2>3. Adding static covariates at TimeSeries construction<a class="headerlink" href="#3.-Adding-static-covariates-at-TimeSeries-construction" title="Permalink to this headline">¶</a></h2>
<p>Static covariates can also directly be added when creating a time series with parameter <code class="docutils literal notranslate"><span class="pre">static_covariates</span></code> in most of <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_*()</span></code> methods.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># add arbitrary continuous and categorical static covariates
series = TimeSeries.from_values(
    values=np.random.random((10, 3)),
    columns=[&quot;comp1&quot;, &quot;comp2&quot;, &quot;comp3&quot;],
    static_covariates=static_covs_multi,
)
print(series.static_covariates)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
static_covariates  cont cat
component
comp1               0.0   a
comp2               2.0   c
comp3               1.0   b
</pre></div></div>
</div>
</section>
<section id="Using-static-covariates-with-multiple-TimeSeries">
<h2>Using static covariates with multiple TimeSeries<a class="headerlink" href="#Using-static-covariates-with-multiple-TimeSeries" title="Permalink to this headline">¶</a></h2>
<p>Static covariates are only really useful if we use them across multiple TimeSeries. By convention, the static covariates layout (pd.DataFrame columns, index) has to be the same for all series.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>first_series = series.with_static_covariates(
    pd.DataFrame(data={&quot;ID&quot;: [&quot;SERIES1&quot;], &quot;var1&quot;: [0.5]})
)
second_series = series.with_static_covariates(
    pd.DataFrame(data={&quot;ID&quot;: [&quot;SERIES2&quot;], &quot;var1&quot;: [0.75]})
)

print(&quot;Valid static covariates for multiple series&quot;)
print(first_series.static_covariates)
print(second_series.static_covariates)

series_multi = [first_series, second_series]
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Valid static covariates for multiple series
static_covariates       ID  var1
global_components  SERIES1   0.5
static_covariates       ID  var1
global_components  SERIES2  0.75
</pre></div></div>
</div>
</section>
<section id="4.-Extract-a-list-of-time-series-by-groups-from-a-DataFrame-using-from_group_dataframe()">
<h2>4. Extract a list of time series by groups from a DataFrame using <code class="docutils literal notranslate"><span class="pre">from_group_dataframe()</span></code><a class="headerlink" href="#4.-Extract-a-list-of-time-series-by-groups-from-a-DataFrame-using-from_group_dataframe()" title="Permalink to this headline">¶</a></h2>
<p>If your DataFrame contains multiple time series which are stacked vertically, you can use <code class="docutils literal notranslate"><span class="pre">TimeSeries.from_group_dataframe()</span></code> (see the docs <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.timeseries.html#darts.timeseries.TimeSeries.from_group_dataframe">here</a>) to extract them as a list of TimeSeries instances. This requires a column or list of columns for which the DataFrame should grouped by (parameter <code class="docutils literal notranslate"><span class="pre">group_cols</span></code>). <code class="docutils literal notranslate"><span class="pre">group_cols</span></code> will automatically be added as static covariates to
the individual series. Additional columns can be used as static covariates with parameter <code class="docutils literal notranslate"><span class="pre">static_cols</span></code>.</p>
<p>In the example below, we generate a DataFrame which contains data of two distinct time series (overlapping/repeating dates) “SERIES1” and “SERIES2” and extract the TimeSeries with <code class="docutils literal notranslate"><span class="pre">from_group_dataframe()</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span># generate an DataFrame example
df = pd.DataFrame(
    data={
        &quot;dates&quot;: [
            &quot;2020-01-01&quot;,
            &quot;2020-01-02&quot;,
            &quot;2020-01-03&quot;,
            &quot;2020-01-01&quot;,
            &quot;2020-01-02&quot;,
            &quot;2020-01-03&quot;,
        ],
        &quot;comp1&quot;: np.random.random((6,)),
        &quot;comp2&quot;: np.random.random((6,)),
        &quot;comp3&quot;: np.random.random((6,)),
        &quot;ID&quot;: [&quot;SERIES1&quot;, &quot;SERIES1&quot;, &quot;SERIES1&quot;, &quot;SERIES2&quot;, &quot;SERIES2&quot;, &quot;SERIES2&quot;],
        &quot;var1&quot;: [0.5, 0.5, 0.5, 0.75, 0.75, 0.75],
    }
)
print(&quot;Input DataFrame&quot;)
print(df)

series_multi = TimeSeries.from_group_dataframe(
    df,
    time_col=&quot;dates&quot;,
    group_cols=&quot;ID&quot;,  # individual time series are extracted by grouping `df` by `group_cols`
    static_cols=[
        &quot;var1&quot;
    ],  # also extract these additional columns as static covariates (without grouping)
    value_cols=[
        &quot;comp1&quot;,
        &quot;comp2&quot;,
        &quot;comp3&quot;,
    ],  # optionally, specify the time varying columns
)

print(f&quot;\n{len(series_multi)} series were extracted from the input DataFrame&quot;)
for i, ts in enumerate(series_multi):
    print(f&quot;Static covariates of series {i}&quot;)
    print(ts.static_covariates)
    ts[&quot;comp1&quot;].plot(label=f&quot;comp1_series_{i}&quot;)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Input DataFrame
        dates     comp1     comp2     comp3       ID  var1
0  2020-01-01  0.158970  0.820993  0.976761  SERIES1  0.50
1  2020-01-02  0.110375  0.097101  0.604846  SERIES1  0.50
2  2020-01-03  0.656330  0.837945  0.739264  SERIES1  0.50
3  2020-01-01  0.138183  0.096098  0.039188  SERIES2  0.75
4  2020-01-02  0.196582  0.976459  0.282807  SERIES2  0.75
5  2020-01-03  0.368725  0.468651  0.120197  SERIES2  0.75

2 series were extracted from the input DataFrame
Static covariates of series 0
static_covariates       ID  var1
global_components  SERIES1   0.5
Static covariates of series 1
static_covariates       ID  var1
global_components  SERIES2  0.75
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_14_1.png" src="../_images/examples_15-static-covariates_14_1.png" />
</div>
</div>
</section>
<section id="5.-Scaling/Encoding/Transforming-static-covariate-data">
<h2>5. Scaling/Encoding/Transforming static covariate data<a class="headerlink" href="#5.-Scaling/Encoding/Transforming-static-covariate-data" title="Permalink to this headline">¶</a></h2>
<p>There might be the need to scale numeric static covariates or encode categorical static covariates as not all models can handle non numeric static covariates.</p>
<p>Use <code class="docutils literal notranslate"><span class="pre">StaticCovariatesTransformer</span></code> (see the docs <a class="reference external" href="https://unit8co.github.io/darts/generated_api/darts.dataprocessing.transformers.static_covariates_transformer.html#staticcovariatestransformer">here</a>) to scale/transform static covariates. By default it uses a <code class="docutils literal notranslate"><span class="pre">MinMaxScaler</span></code> to scale numeric data, and a <code class="docutils literal notranslate"><span class="pre">OrdinalEncoder</span></code> to encode categorical data. Both the numeric and categorical transformers will be fit globally on static covariate data of all time series passed to
<code class="docutils literal notranslate"><span class="pre">StaticCovariatesTransformer.fit()</span></code></p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>from darts.dataprocessing.transformers import StaticCovariatesTransformer

transformer = StaticCovariatesTransformer()
series_transformed = transformer.fit_transform(series_multi)

for i, (ts, ts_scaled) in enumerate(zip(series_multi, series_transformed)):
    print(f&quot;Original series {i}&quot;)
    print(ts.static_covariates)
    print(f&quot;Transformed series {i}&quot;)
    print(ts_scaled.static_covariates)
    print(&quot;&quot;)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Original series 0
static_covariates       ID  var1
global_components  SERIES1   0.5
Transformed series 0
static_covariates   ID  var1
global_components  0.0   0.0

Original series 1
static_covariates       ID  var1
global_components  SERIES2  0.75
Transformed series 1
static_covariates   ID  var1
global_components  1.0   1.0

</pre></div></div>
</div>
</section>
<section id="6.-Forecasting-example-with-TFTModel-and-static-covariates">
<h2>6. Forecasting example with <code class="docutils literal notranslate"><span class="pre">TFTModel</span></code> and static covariates<a class="headerlink" href="#6.-Forecasting-example-with-TFTModel-and-static-covariates" title="Permalink to this headline">¶</a></h2>
<p>Now let’s find out if adding static covariates to a forecasting problem can improve predictive accuracy. We’ll use <code class="docutils literal notranslate"><span class="pre">TFTModel</span></code> which supports numeric and categorical static covariates.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>import numpy as np
import pandas as pd
import matplotlib.pyplot as plt
from pytorch_lightning.callbacks import TQDMProgressBar

from darts import TimeSeries
from darts.models import TFTModel
from darts.utils import timeseries_generation as tg
from darts.dataprocessing.transformers import StaticCovariatesTransformer
from darts.metrics import rmse
</pre></div>
</div>
</div>
<section id="6.1-Experiment-setup">
<h3>6.1 Experiment setup<a class="headerlink" href="#6.1-Experiment-setup" title="Permalink to this headline">¶</a></h3>
<p>For our experiment, we generate two time series: a fully sine wave series (label = smooth) and sine wave series with some irregularities every other period (label = irregular, see the ramps at periods 2 and 4).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>period = 20
sine_series = tg.sine_timeseries(
    length=4 * period, value_frequency=1 / period, column_name=&quot;smooth&quot;, freq=&quot;h&quot;
)

sine_vals = sine_series.values()
linear_vals = np.expand_dims(np.linspace(1, -1, num=19), -1)

sine_vals[21:40] = linear_vals
sine_vals[61:80] = linear_vals
irregular_series = TimeSeries.from_times_and_values(
    values=sine_vals, times=sine_series.time_index, columns=[&quot;irregular&quot;]
)
sine_series.plot()
irregular_series.plot()
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_20_0.png" src="../_images/examples_15-static-covariates_20_0.png" />
</div>
</div>
<p>We will use three different setups for training and evaluation:</p>
<ol class="arabic simple">
<li><p>fit/predict without static covariates</p></li>
<li><p>fit/predict with binary (numeric) static covariates</p></li>
<li><p>fit/predict with categorical static covariates</p></li>
</ol>
<p>For each setup we’ll train the model on both series and then only use only the 3rd period (sine wave for both series) to predict the 4th period (sine for “smooth” and ramp for “irregular”).</p>
<p>What we hope for is that the model without static covariates performs worse than the other ones. The non-static model should not be able to recognize whether the underlying series used in <code class="docutils literal notranslate"><span class="pre">predict()</span></code> is the <em>smooth</em> or the <em>irregular</em> series as it only gets a sine wave curve as input (3rd period). This should result in a forecast somewhere inbetween the smooth and irregular series (learned by minimizing the global loss during training).</p>
<p>Now this is where static covariates can really help. For example, we can embed data about the curve type into the <strong>target</strong> series through static covariates. With this information, we’d expect the models to generate improved forecasts.</p>
<p>First we create some helper functions to apply the same experiment conditions to all models.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>def test_case(model, train_series, predict_series):
    &quot;&quot;&quot;helper function which performs model training, prediction and plotting&quot;&quot;&quot;
    model.fit(train_series)
    preds = model.predict(n=int(period / 2), num_samples=250, series=predict_series)
    for ts, ps in zip(train_series, preds):
        ts.plot()
        ps.plot()
        plt.show()
    return preds


def get_model_params():
    &quot;&quot;&quot;helper function that generates model parameters with a new Progress Bar object&quot;&quot;&quot;
    return {
        &quot;input_chunk_length&quot;: int(period / 2),
        &quot;output_chunk_length&quot;: int(period / 2),
        &quot;add_encoders&quot;: {
            &quot;datetime_attribute&quot;: {&quot;future&quot;: [&quot;hour&quot;]}
        },  # TFTModel requires future input, with this we won&#39;t have to supply any future_covariates
        &quot;random_state&quot;: 42,
        &quot;n_epochs&quot;: 150,
        &quot;pl_trainer_kwargs&quot;: {
            &quot;callbacks&quot;: [TQDMProgressBar(refresh_rate=4)],
        },
    }
</pre></div>
</div>
</div>
</section>
</section>
<section id="6.2-Forecasting-without-static-covariates">
<h2>6.2 Forecasting without static covariates<a class="headerlink" href="#6.2-Forecasting-without-static-covariates" title="Permalink to this headline">¶</a></h2>
<p>Let’s train the first model without any static covariates</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>train_series = [sine_series, irregular_series]
for series in train_series:
    assert not series.has_static_covariates

model = TFTModel(**get_model_params())
preds = test_case(
    model,
    train_series,
    predict_series=[series[:60] for series in train_series],
)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "31b92b964c394b56a810ce08e1cc183b", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "63867797f5cb4e008ffa6d63b619bd79", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_24_2.png" src="../_images/examples_15-static-covariates_24_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_24_3.png" src="../_images/examples_15-static-covariates_24_3.png" />
</div>
</div>
<p>From the plot you can see that the forecast began after period 3 (~01-03-2022 - 12:00). The prediciton input were the last <code class="docutils literal notranslate"><span class="pre">input_chunk_length=10</span></code> values - which are identical for both series (sine wave).</p>
<p>As expected, the model was not able to determine the type of the underlying prediciton series (smooth or irregular) and generate a sine-wave like forecast for both.</p>
</section>
<section id="6.3-Forecasting-with-0/1-binary-static-covariates-(numeric)">
<h2>6.3 Forecasting with 0/1 binary static covariates (numeric)<a class="headerlink" href="#6.3-Forecasting-with-0/1-binary-static-covariates-(numeric)" title="Permalink to this headline">¶</a></h2>
<p>Now let’s repeat the experiment but this time we add information about the curve type as a binary (numeric) static covariate named <code class="docutils literal notranslate"><span class="pre">&quot;curve_type&quot;</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>sine_series_st_bin = sine_series.with_static_covariates(
    pd.DataFrame(data={&quot;curve_type&quot;: [1]})
)
irregular_series_st_bin = irregular_series.with_static_covariates(
    pd.DataFrame(data={&quot;curve_type&quot;: [0]})
)

train_series = [sine_series_st_bin, irregular_series_st_bin]
for series in train_series:
    print(series.static_covariates)

model = TFTModel(**get_model_params())
preds_st_bin = test_case(
    model,
    train_series,
    predict_series=[series[:60] for series in train_series],
)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
static_covariates  curve_type
component
smooth                    1.0
static_covariates  curve_type
component
irregular                 0.0
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "b17832db6fc84829b06460deb68720eb", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "13f9ef422e1747c4bf21ea4dc2f090e0", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_27_3.png" src="../_images/examples_15-static-covariates_27_3.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_27_4.png" src="../_images/examples_15-static-covariates_27_4.png" />
</div>
</div>
<p>That already looks much better! The model was able to identify the curve type/category from the binary static covariate feature.</p>
</section>
<section id="6.4-Forecasting-with-categorical-static-covariates">
<h2>6.4 Forecasting with categorical static covariates<a class="headerlink" href="#6.4-Forecasting-with-categorical-static-covariates" title="Permalink to this headline">¶</a></h2>
<p>The last experiment already showed promising results. So why not only use binary features for categorical data? While it might have worked well for our two time series, if we had more curve types we’d need to one hot encode the feature into a binary variable for each category. With a lot of categories, this lead to a large number of features/predictors and multicollinearity which can lower the model’s predictive accuracy.</p>
<p>As a last experiment, let’s use the curve type as a categorical feature. <code class="docutils literal notranslate"><span class="pre">TFTModel</span></code> learns an embedding for categorical features. Darts’ <code class="docutils literal notranslate"><span class="pre">TorchForecastingModels</span></code> (such as <code class="docutils literal notranslate"><span class="pre">TFTModel</span></code>) only support numeric data. Before training we need to transform the <code class="docutils literal notranslate"><span class="pre">&quot;curve_type&quot;</span></code> into a integer-valued feature with <code class="docutils literal notranslate"><span class="pre">StaticCovariatesTransformer</span></code> (see section 5.).</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>sine_series_st_cat = sine_series.with_static_covariates(
    pd.DataFrame(data={&quot;curve_type&quot;: [&quot;smooth&quot;]})
)
irregular_series_st_cat = irregular_series.with_static_covariates(
    pd.DataFrame(data={&quot;curve_type&quot;: [&quot;non_smooth&quot;]})
)

train_series = [sine_series_st_cat, irregular_series_st_cat]
print(&quot;Static covariates before encoding:&quot;)
print(train_series[0].static_covariates)

# use StaticCovariatesTransformer to encode categorical static covariates into numeric data
scaler = StaticCovariatesTransformer()
train_series = scaler.fit_transform(train_series)
print(&quot;\nStatic covariates after encoding:&quot;)
print(train_series[0].static_covariates)
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Static covariates before encoding:
static_covariates curve_type
component
smooth                smooth

Static covariates after encoding:
static_covariates  curve_type
component
smooth                    1.0
</pre></div></div>
</div>
<p>No all we need to do is tell <code class="docutils literal notranslate"><span class="pre">TFTModel</span></code> that <code class="docutils literal notranslate"><span class="pre">&quot;curve_type&quot;</span></code> is a categorical variable that requires embedding. We can do so with model parameter <code class="docutils literal notranslate"><span class="pre">categorical_embedding_sizes</span></code> which is a dictionary of: {feature name: (number of categories, embedding size)}</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>n_categories = 2  # &quot;smooth&quot; and &quot;non_smooth&quot;
embedding_size = 2  # embed the categorical variable into a numeric vector of size 2
categorical_embedding_sizes = {&quot;curve_type&quot;: (n_categories, embedding_size)}

model = TFTModel(
    categorical_embedding_sizes=categorical_embedding_sizes, **get_model_params()
)
preds_st_cat = test_case(
    model,
    train_series,
    predict_series=[series[:60] for series in train_series],
)
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "f1983e6ef63f4619b3ba3c30a1e09caf", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<script type="application/vnd.jupyter.widget-view+json">{"model_id": "39da49b9c3154d63886b7d06aed093fa", "version_major": 2, "version_minor": 0}</script></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_32_2.png" src="../_images/examples_15-static-covariates_32_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_32_3.png" src="../_images/examples_15-static-covariates_32_3.png" />
</div>
</div>
<p>Nice, that seems to have worked as well! As a last step, let’s look at how the models performed compared to each other.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span>for series, ps_no_st, ps_st_bin, ps_st_cat in zip(
    train_series, preds, preds_st_bin, preds_st_cat
):
    series[-40:].plot(label=&quot;target&quot;)
    ps_no_st.quantile(0.5).plot(label=&quot;no static covs&quot;)
    ps_st_bin.quantile(0.5).plot(label=&quot;binary static covs&quot;)
    ps_st_cat.quantile(0.5).plot(label=&quot;categorical static covs&quot;)
    plt.show()
    print(&quot;Metric&quot;)
    print(
        pd.DataFrame(
            {
                name: [rmse(series, ps)]
                for name, ps in zip(
                    [&quot;no st&quot;, &quot;bin st&quot;, &quot;cat st&quot;], [ps_no_st, ps_st_bin, ps_st_cat]
                )
            },
            index=[&quot;RMSE&quot;],
        )
    )
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_34_0.png" src="../_images/examples_15-static-covariates_34_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Metric
         no st    bin st    cat st
RMSE  0.118806  0.034682  0.056417
</pre></div></div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_15-static-covariates_34_2.png" src="../_images/examples_15-static-covariates_34_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Metric
         no st    bin st    cat st
RMSE  0.302874  0.152379  0.128684
</pre></div></div>
</div>
<p>These are great results! Both approaches using static covariates decreased the RMSE by more than halve for both series compared to the baseline!</p>
<p><em>Note that we only used one static covariate feature, but you can use as many as want including mixtures of data types (numeric and categorical).</em></p>
</section>
</section>


              </div>
              
              
              <!-- Previous / next buttons -->
<div class='prev-next-area'> 
    <a class='left-prev' id="prev-link" href="02-data-processing.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Data (pre) processing using <code class="docutils literal notranslate"><span class="pre">DataTransformer</span></code> and <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="14-transfer-learning.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Transfer Learning for Time Series Forecasting with Darts</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
              
          </main>
          

      </div>
    </div>
  
  <script src="../_static/js/index.be7d3bbb2ef33a8344ce.js"></script>
<footer class="footer mt-5 mt-md-0">
  <div class="container">
    
    <div class="footer-item">
      <p class="copyright">
    &copy; Copyright 2020 - 2022, Unit8 SA (Apache 2.0 License).<br>
</p>
    </div>
    
    <div class="footer-item">
      <p class="sphinx-version">
Created using <a href="http://sphinx-doc.org/">Sphinx</a> 4.3.2.<br>
</p>
    </div>
    
  </div>
</footer>
  </body>
</html>