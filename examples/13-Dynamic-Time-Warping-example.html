
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Dynamic Time Warping (DTW) &#8212; darts  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/darts-logo-trim.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../README.html">Home</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../generated_api/darts.html">API Reference</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../examples.html">Examples</a>
        </li>
        
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/unit8co/darts" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/unit8co" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Read-and-Format" class="nav-link">Read and Format</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Determine-the-Number-of-Peaks" class="nav-link">Determine the Number of Peaks</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Generate-a-Pattern-to-Compare-With" class="nav-link">Generate a Pattern to Compare With</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Fit-the-Pattern-to-the-Series" class="nav-link">Fit the Pattern to the Series</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Quantitative-Comparison" class="nav-link">Quantitative Comparison</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Enter-Dynamic-Time-Warping" class="nav-link">Enter Dynamic Time Warping</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#No-Window" class="nav-link">No Window</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Multi-Grid" class="nav-link">Multi-Grid</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Diagonal-Window-(SakoeChiba)" class="nav-link">Diagonal Window (SakoeChiba)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Parallelogram-Window-(Itakura)" class="nav-link">Parallelogram Window (Itakura)</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Comparison-of-the-Different-Alignments" class="nav-link">Comparison of the Different Alignments</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Visualizing-the-Alignment" class="nav-link">Visualizing the Alignment</a><ul class="nav section-nav flex-column">
                
        <li class="nav-item toc-entry toc-h3">
            <a href="#Warped-Time-Series" class="nav-link">Warped Time Series</a>
        </li>
    
            </ul>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#id1" class="nav-link">Quantitative Comparison</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Finding-Matching-Subsequences" class="nav-link">Finding Matching Subsequences</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Visualizing-the-Matching-Subsequences" class="nav-link">Visualizing the Matching Subsequences</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Dynamic-Time-Warping-(DTW)">
<h1>Dynamic Time Warping (DTW)<a class="headerlink" href="#Dynamic-Time-Warping-(DTW)" title="Permalink to this headline">¶</a></h1>
<p>The following offers a demonstration of the capabalities of the DTW module within darts. Dynamic Time Warping allows you to compare two time series of different lengths and time axese. The algorithm will determine the optimal alignment between elements in the two series, such that the pair-wise distance between them is minimized.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># fix python path if working locally</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">fix_pythonpath_if_working_locally</span>
<span class="n">fix_pythonpath_if_working_locally</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline

<span class="kn">from</span> <span class="nn">darts.dataprocessing</span> <span class="kn">import</span> <span class="n">dtw</span>
<span class="kn">from</span> <span class="nn">darts.utils</span> <span class="kn">import</span> <span class="n">timeseries_generation</span> <span class="k">as</span> <span class="n">tg</span>
<span class="kn">from</span> <span class="nn">darts.utils.missing_values</span> <span class="kn">import</span> <span class="n">fill_missing_values</span>
<span class="kn">from</span> <span class="nn">darts.datasets</span> <span class="kn">import</span> <span class="n">SunspotsDataset</span>
<span class="kn">from</span> <span class="nn">darts.timeseries</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">darts.metrics</span> <span class="kn">import</span> <span class="n">dtw_metric</span><span class="p">,</span> <span class="n">mae</span><span class="p">,</span> <span class="n">mape</span>
<span class="kn">from</span> <span class="nn">darts.models.filtering_model</span> <span class="kn">import</span> <span class="n">MovingAverage</span>
<span class="kn">from</span> <span class="nn">scipy.signal</span> <span class="kn">import</span> <span class="n">argrelextrema</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
</pre></div>
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">SMALL_SIZE</span> <span class="o">=</span> <span class="mi">30</span>
<span class="n">MEDIUM_SIZE</span> <span class="o">=</span> <span class="mi">35</span>
<span class="n">BIGGER_SIZE</span> <span class="o">=</span> <span class="mi">40</span>
<span class="n">FIG_WIDTH</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">FIG_SIZE</span> <span class="o">=</span> <span class="p">(</span><span class="mi">40</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>


<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;font&#39;</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>          <span class="c1"># controls default text sizes</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>     <span class="c1"># fontsize of the axes title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;axes&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">MEDIUM_SIZE</span><span class="p">)</span>    <span class="c1"># fontsize of the x and y labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;xtick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;ytick&#39;</span><span class="p">,</span> <span class="n">labelsize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>    <span class="c1"># fontsize of the tick labels</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;legend&#39;</span><span class="p">,</span> <span class="n">fontsize</span><span class="o">=</span><span class="n">SMALL_SIZE</span><span class="p">)</span>    <span class="c1"># legend fontsize</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">titlesize</span><span class="o">=</span><span class="n">BIGGER_SIZE</span><span class="p">)</span>  <span class="c1"># fontsize of the figure title</span>
<span class="n">plt</span><span class="o">.</span><span class="n">rc</span><span class="p">(</span><span class="s1">&#39;figure&#39;</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="n">FIG_SIZE</span><span class="p">)</span>       <span class="c1"># size of the figure</span>
</pre></div>
</div>
</div>
<section id="Read-and-Format">
<h2>Read and Format<a class="headerlink" href="#Read-and-Format" title="Permalink to this headline">¶</a></h2>
<p>Here we simply read the CSV file containing the number of sunspots, and transform the values into the desired format. We resample the dateset to eliminate high-frequency noise, as we are only interested in the general shape.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">SunspotsDataset</span><span class="p">()</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ts</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">resample</span><span class="p">(</span><span class="n">freq</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">)</span>
<span class="n">ts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_5_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_5_0.png" />
</div>
</div>
</section>
<section id="Determine-the-Number-of-Peaks">
<h2>Determine the Number of Peaks<a class="headerlink" href="#Determine-the-Number-of-Peaks" title="Permalink to this headline">¶</a></h2>
<p>We observe that the series is composed of a series of sharp peaks and troughs. Let’s quickly determine the number of periods to consider. We begin by applying a moving average filter to the series, to eliminate false local maxima. Then we simply count the number of local maxima returned by argrelextrema.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts_smooth</span> <span class="o">=</span> <span class="n">MovingAverage</span><span class="p">(</span><span class="n">window</span> <span class="o">=</span> <span class="mi">3</span><span class="p">)</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span>

<span class="n">minimums</span> <span class="o">=</span> <span class="n">argrelextrema</span><span class="p">(</span><span class="n">ts_smooth</span><span class="o">.</span><span class="n">univariate_values</span><span class="p">(),</span> <span class="n">np</span><span class="o">.</span><span class="n">greater</span><span class="p">)</span>

<span class="n">periods</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">minimums</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
<span class="n">periods</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
24
</pre></div></div>
</div>
</section>
<section id="Generate-a-Pattern-to-Compare-With">
<h2>Generate a Pattern to Compare With<a class="headerlink" href="#Generate-a-Pattern-to-Compare-With" title="Permalink to this headline">¶</a></h2>
<p>Here we simply construct a simplified pattern based on the previous observation, of linear peaks and troughs. We ensure that the mean is 0 and range is 1, to make it easier to fit to the data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">steps</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">ceil</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="n">periods</span><span class="o">*</span><span class="mi">2</span><span class="p">)))</span>
<span class="n">down</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.5</span><span class="p">,</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
<span class="n">up</span>   <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="o">-</span><span class="mf">0.5</span><span class="p">,</span><span class="mf">0.5</span><span class="p">,</span><span class="n">steps</span><span class="o">+</span><span class="mi">1</span><span class="p">)[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>

<span class="n">values</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">tile</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">down</span><span class="p">,</span><span class="n">up</span><span class="p">),</span> <span class="n">periods</span><span class="p">),</span> <span class="mf">0.5</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">)),</span> <span class="n">values</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_9_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_9_0.png" />
</div>
</div>
</section>
<section id="Fit-the-Pattern-to-the-Series">
<h2>Fit the Pattern to the Series<a class="headerlink" href="#Fit-the-Pattern-to-the-Series" title="Permalink to this headline">¶</a></h2>
<p>We rescale and shift the data to be inline with the actual series. Then we create a new <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code>, with the same time axis as the Sunspot dataset. While this is not necessary to perform Dynamic Time Warping, it will enable us to plot and compare the initial alignment. Since our pattern is slightly longer than the Sunspot time series itself, we drop all values past the end date.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">m</span> <span class="o">=</span> <span class="mi">90</span>
<span class="n">c</span> <span class="o">=</span> <span class="mi">55</span>

<span class="n">scaled_values</span> <span class="o">=</span> <span class="n">values</span> <span class="o">*</span> <span class="n">m</span> <span class="o">+</span> <span class="n">c</span>

<span class="n">time_range</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">date_range</span><span class="p">(</span><span class="n">start</span><span class="o">=</span><span class="n">ts</span><span class="o">.</span><span class="n">start_time</span><span class="p">(),</span> <span class="n">freq</span><span class="o">=</span><span class="s1">&#39;y&#39;</span><span class="p">,</span> <span class="n">periods</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">values</span><span class="p">))</span>
<span class="n">ts_shape_series</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">(</span><span class="n">scaled_values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="n">time_range</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Shape&quot;</span><span class="p">)</span>

<span class="n">ts_shape</span> <span class="o">=</span> <span class="n">TimeSeries</span><span class="o">.</span><span class="n">from_series</span><span class="p">(</span><span class="n">ts_shape_series</span><span class="p">)</span>
<span class="n">ts_shape</span> <span class="o">=</span> <span class="n">ts_shape</span><span class="o">.</span><span class="n">drop_after</span><span class="p">(</span><span class="n">ts</span><span class="o">.</span><span class="n">end_time</span><span class="p">())</span>
<span class="n">ts_shape</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">ts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_11_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_11_0.png" />
</div>
</div>
</section>
<section id="Quantitative-Comparison">
<h2>Quantitative Comparison<a class="headerlink" href="#Quantitative-Comparison" title="Permalink to this headline">¶</a></h2>
<p>We can use MEAN ABSOLUTE ERROR also known as <code class="docutils literal notranslate"><span class="pre">mae</span></code>, to evaluate how closely our simple pattern fits the data. Looking at the plot above it is clear that that there is some fluctuation in the time between peaks, leading to a misalignment and a relatively high error.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">original_mae</span> <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">)</span>
<span class="n">original_mae</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
34.01837606837607
</pre></div></div>
</div>
</section>
<section id="Enter-Dynamic-Time-Warping">
<h2>Enter Dynamic Time Warping<a class="headerlink" href="#Enter-Dynamic-Time-Warping" title="Permalink to this headline">¶</a></h2>
<p>Fortunately finding the optimal alignment between two series is exactly what DTW was designed for! All we have to do is call the dtw with two time series.</p>
<section id="No-Window">
<h3>No Window<a class="headerlink" href="#No-Window" title="Permalink to this headline">¶</a></h3>
<p>The default behaviour is to consider all possible alignments between the time series. This becomes obvious when we plot the cost matrix, together with the path using <code class="docutils literal notranslate"><span class="pre">.plot()</span></code>. The cost matrix indicates the total cost/distance of the alignment that would match (i,j) together. For our timeseries we observe a dark green band passing through the diagonal. This indicates that the two time series are mostly aligned to begin with.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">exact_alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">)</span>
<span class="n">exact_alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">show_series</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_16_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_16_0.png" />
</div>
</div>
</section>
</section>
<section id="Multi-Grid">
<h2>Multi-Grid<a class="headerlink" href="#Multi-Grid" title="Permalink to this headline">¶</a></h2>
<p>Computing all possible alignment quickly becomes computationally expensive on large datasets (quadratic complexity).</p>
<p>Instead we can use the multi grid solver, which runs in near linear-time. The solver determine the optimal path first on a smaller grid, and then recursively reprojects and refines the path, each time doubling the resolution. Simply enabling the multi-grid solver (linear complexity) will usually result in a large speed-up, without much loss of accuracy.</p>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">multi_grid_radius</span></code> controls how much to extend the search window by from the path found at a lower resolution. In other words, you gain accuracy at the cost of performance by increasing it.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">multi_grid_radius</span> <span class="o">=</span> <span class="mi">10</span>

<span class="n">multigrid_alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">,</span> <span class="n">multi_grid_radius</span> <span class="o">=</span> <span class="n">multi_grid_radius</span><span class="p">)</span>
<span class="n">multigrid_alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_18_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_18_0.png" />
</div>
</div>
</section>
<section id="Diagonal-Window-(SakoeChiba)">
<h2>Diagonal Window (SakoeChiba)<a class="headerlink" href="#Diagonal-Window-(SakoeChiba)" title="Permalink to this headline">¶</a></h2>
<p>The SakoeChiba window forms a diagonal band, determined by the <code class="docutils literal notranslate"><span class="pre">window_size</span></code> parameter. The window is best applied when you know that the two time series are already mostly aligned or want to constrain the amount of warping. It will ensure that element n in one series, is only every matched with element n-window_size in the other.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">sakoechiba_alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">SakoeChiba</span><span class="p">(</span><span class="n">window_size</span> <span class="o">=</span> <span class="mi">10</span><span class="p">))</span>
<span class="n">sakoechiba_alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_20_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_20_0.png" />
</div>
</div>
</section>
<section id="Parallelogram-Window-(Itakura)">
<h2>Parallelogram Window (Itakura)<a class="headerlink" href="#Parallelogram-Window-(Itakura)" title="Permalink to this headline">¶</a></h2>
<p>The parameter <code class="docutils literal notranslate"><span class="pre">max_slope</span></code> controls the gradient of the steeper side of the parallelogram. For our time-series the window is somewhat wastefull as the optimal path does not deviate significantly from the diagonal.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">itakura_alignment</span> <span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">dtw</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">,</span> <span class="n">window</span><span class="o">=</span> <span class="n">dtw</span><span class="o">.</span><span class="n">Itakura</span><span class="p">(</span><span class="n">max_slope</span> <span class="o">=</span> <span class="mf">1.5</span><span class="p">))</span>
<span class="n">itakura_alignment</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_22_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_22_0.png" />
</div>
</div>
</section>
<section id="Comparison-of-the-Different-Alignments">
<h2>Comparison of the Different Alignments<a class="headerlink" href="#Comparison-of-the-Different-Alignments" title="Permalink to this headline">¶</a></h2>
<p>Though each of the windows will have resulted in different runtimes, the length of the paths are effectively identical. Were we to constrain the windows further or reduce the multi_grid_radius, we would find the optimal path to be a shorter than the rest.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">alignments</span> <span class="o">=</span> <span class="p">[</span><span class="n">exact_alignment</span><span class="p">,</span> <span class="n">multigrid_alignment</span><span class="p">,</span> <span class="n">sakoechiba_alignment</span><span class="p">,</span> <span class="n">itakura_alignment</span><span class="p">]</span>
<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;Exact (Optimal)&quot;</span><span class="p">,</span> <span class="s2">&quot;Multi-Grid&quot;</span><span class="p">,</span> <span class="s2">&quot;Sakoe-Chiba&quot;</span><span class="p">,</span> <span class="s2">&quot;Itakura&quot;</span><span class="p">]</span>
<span class="n">distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">align</span><span class="o">.</span><span class="n">distance</span><span class="p">()</span> <span class="k">for</span> <span class="n">align</span> <span class="ow">in</span> <span class="n">alignments</span><span class="p">]</span>

<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Absolute DTW Distance (Lower is Better)&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">(</span><span class="n">names</span><span class="p">,</span> <span class="n">distances</span><span class="p">);</span>

<span class="n">alignment</span> <span class="o">=</span> <span class="n">multigrid_alignment</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_24_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_24_0.png" />
</div>
</div>
</section>
<section id="Visualizing-the-Alignment">
<h2>Visualizing the Alignment<a class="headerlink" href="#Visualizing-the-Alignment" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">alignment</span><span class="o">.</span><span class="n">plot_alignment</span><span class="p">(</span><span class="n">pred_series_y_offset</span> <span class="o">=</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s2">&quot;Warp Alignment&quot;</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_26_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_26_0.png" />
</div>
</div>
<section id="Warped-Time-Series">
<h3>Warped Time Series<a class="headerlink" href="#Warped-Time-Series" title="Permalink to this headline">¶</a></h3>
<p>Once we have found an aligment, we can produce two warped series, of the same length. Since we’ve warped the time dimension, by default the new warped series are indexed by <code class="docutils literal notranslate"><span class="pre">pd.RangeIndex</span></code>. Now our simple pattern matches up with the series, despite them not doing so originally!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[27]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">warped_ts</span><span class="p">,</span> <span class="n">warped_ts_shape</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">warped</span><span class="p">()</span>

<span class="n">warped_ts</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Warped Sunspots&quot;</span><span class="p">)</span>
<span class="n">warped_ts_shape</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">label</span> <span class="o">=</span> <span class="s2">&quot;Warped Shape&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_28_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_28_0.png" />
</div>
</div>
</section>
</section>
<section id="id1">
<h2>Quantitative Comparison<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h2>
<p>We can again apply the <code class="docutils literal notranslate"><span class="pre">mae</span></code> metric, however this time to our warped series. If we were interested only in the similarity after warping, we could also just have called the helper function <code class="docutils literal notranslate"><span class="pre">dtw_metric</span></code>. Notice the ~65% reduction in the error between the warped series!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">warped_mae0</span>  <span class="o">=</span> <span class="n">dtw_metric</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_shape</span><span class="p">,</span> <span class="n">metric</span> <span class="o">=</span> <span class="n">mae</span><span class="p">,</span> <span class="n">multi_grid_radius</span> <span class="o">=</span> <span class="n">multi_grid_radius</span><span class="p">)</span>
<span class="n">warped_mae1</span>  <span class="o">=</span> <span class="n">mae</span><span class="p">(</span><span class="n">warped_ts</span><span class="p">,</span> <span class="n">warped_ts_shape</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">bar</span><span class="p">([</span><span class="s2">&quot;Original&quot;</span><span class="p">,</span> <span class="s2">&quot;Warped&quot;</span><span class="p">,</span> <span class="s2">&quot;DTW Metric&quot;</span><span class="p">],</span> <span class="p">[</span><span class="n">original_mae</span><span class="p">,</span> <span class="n">warped_mae0</span><span class="p">,</span> <span class="n">warped_mae1</span><span class="p">]);</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_30_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_30_0.png" />
</div>
</div>
</section>
<section id="Finding-Matching-Subsequences">
<h2>Finding Matching Subsequences<a class="headerlink" href="#Finding-Matching-Subsequences" title="Permalink to this headline">¶</a></h2>
<p>Given the alignment we can find matching subsequences of the two time series.</p>
<ol class="arabic simple">
<li><p>The difference between two elements is smaller than some threshold</p></li>
<li><p>The original pattern was not distorted</p></li>
<li><p>The subsequence has some minimum length</p></li>
</ol>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">THRESHOLD</span> <span class="o">=</span> <span class="mi">20</span>
<span class="n">MATCH_MIN_LENGTH</span> <span class="o">=</span> <span class="mi">5</span>

<span class="n">path</span> <span class="o">=</span> <span class="n">alignment</span><span class="o">.</span><span class="n">path</span><span class="p">()</span>
<span class="n">path</span> <span class="o">=</span> <span class="n">path</span><span class="o">.</span><span class="n">reshape</span><span class="p">((</span><span class="o">-</span><span class="mi">1</span><span class="p">,))</span>

<span class="n">warped_ts_values</span> <span class="o">=</span> <span class="n">warped_ts</span><span class="o">.</span><span class="n">univariate_values</span><span class="p">()</span>
<span class="n">warped_ts_shape_values</span> <span class="o">=</span> <span class="n">warped_ts_shape</span><span class="o">.</span><span class="n">univariate_values</span><span class="p">()</span>

<span class="n">within_threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">warped_ts_values</span> <span class="o">-</span> <span class="n">warped_ts_shape_values</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">THRESHOLD</span> <span class="c1"># Criterion 1</span>
<span class="n">linear_match</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">diff</span><span class="p">(</span><span class="n">path</span><span class="p">[</span><span class="mi">1</span><span class="p">::</span><span class="mi">2</span><span class="p">])</span> <span class="o">==</span> <span class="mi">1</span> <span class="c1"># Criterion 2</span>

<span class="n">matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">logical_and</span><span class="p">(</span><span class="n">within_threshold</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="kc">True</span><span class="p">,</span> <span class="n">linear_match</span><span class="p">))</span>
<span class="k">if</span> <span class="ow">not</span> <span class="n">matches</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span> <span class="n">matches</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">matches</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>

<span class="n">matched_ranges</span> <span class="o">=</span> <span class="p">[]</span>
<span class="n">match_begin</span> <span class="o">=</span> <span class="mi">0</span>

<span class="n">last_m</span> <span class="o">=</span> <span class="kc">False</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">m</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">matches</span><span class="p">):</span>
    <span class="k">if</span> <span class="n">last_m</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">match_end</span> <span class="o">=</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span>
        <span class="n">match_len</span> <span class="o">=</span> <span class="n">match_end</span> <span class="o">-</span> <span class="n">match_begin</span>

        <span class="k">if</span> <span class="n">match_len</span> <span class="o">&gt;=</span> <span class="n">MATCH_MIN_LENGTH</span><span class="p">:</span> <span class="c1"># Criterion 3</span>
            <span class="n">matched_ranges</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">RangeIndex</span><span class="p">(</span><span class="n">match_begin</span><span class="p">,</span> <span class="n">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">))</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">last_m</span> <span class="ow">and</span> <span class="n">m</span><span class="p">:</span>
        <span class="n">match_begin</span> <span class="o">=</span> <span class="n">i</span>
    <span class="n">last_m</span> <span class="o">=</span> <span class="n">m</span>

<span class="n">matched_ranges</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[RangeIndex(start=0, stop=5, step=1),
 RangeIndex(start=16, stop=23, step=1),
 RangeIndex(start=27, stop=33, step=1),
 RangeIndex(start=97, stop=108, step=1),
 RangeIndex(start=115, stop=121, step=1),
 RangeIndex(start=131, stop=138, step=1),
 RangeIndex(start=174, stop=180, step=1),
 RangeIndex(start=218, stop=223, step=1),
 RangeIndex(start=252, stop=258, step=1)]
</pre></div></div>
</div>
</section>
<section id="Visualizing-the-Matching-Subsequences">
<h2>Visualizing the Matching Subsequences<a class="headerlink" href="#Visualizing-the-Matching-Subsequences" title="Permalink to this headline">¶</a></h2>
<p>We can simply index the warped shape series by the RangeIndex to extract the subsequence. Moreover we must shift the series by r.start, to ensure the series begin at the right time. Without this they would all bunch up around time 0.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[22]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">warped_ts</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>

<span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">matched_ranges</span><span class="p">:</span>
    <span class="n">ts_shape_match</span> <span class="o">=</span> <span class="n">warped_ts_shape</span><span class="p">[</span><span class="n">r</span><span class="p">]</span><span class="o">.</span><span class="n">shift</span><span class="p">(</span><span class="n">r</span><span class="o">.</span><span class="n">start</span><span class="p">)</span>
    <span class="n">ts_shape_match</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">color</span><span class="o">=</span> <span class="s2">&quot;red&quot;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">get_legend</span><span class="p">()</span><span class="o">.</span><span class="n">remove</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_13-Dynamic-Time-Warping-example_34_0.png" src="../_images/examples_13-Dynamic-Time-Warping-example_34_0.png" />
</div>
</div>
</section>
</section>


              </div>
              
              
              <div class='prev-next-bottom'>
                

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2021, Unit8 SA.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>