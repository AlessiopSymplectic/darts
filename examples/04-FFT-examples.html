
<!DOCTYPE html>

<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Fast Fourier Transform Forecasting Model (FFT) &#8212; darts  documentation</title>
    
  <link rel="stylesheet" href="../_static/css/index.73d71520a4ca3b99cfee5594769eaaae.css">

    
  <link rel="stylesheet"
    href="../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    
      
  <link rel="stylesheet"
    href="../_static/vendor/open-sans_all/1.44.1/index.css">
  <link rel="stylesheet"
    href="../_static/vendor/lato_latin-ext/1.44.1/index.css">

    
    <link rel="stylesheet" href="../_static/basic.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css" />
    
  <link rel="preload" as="script" href="../_static/js/index.3da636dd464baa7582d2.js">

    <script id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script src="../_static/jquery.js"></script>
    <script src="../_static/underscore.js"></script>
    <script src="../_static/doctools.js"></script>
    <script src="../_static/language_data.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.7/latest.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/x-mathjax-config">MathJax.Hub.Config({"tex2jax": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true, "ignoreClass": "document", "processClass": "math|output_area"}})</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="Recurrent Neural Networks Models" href="05-RNN-examples.html" />
    <link rel="prev" title="Data (pre) processing using DataTransformer and Pipeline" href="03-data-processing.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="en" />
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="80">
    
    <nav class="navbar navbar-light navbar-expand-lg bg-light fixed-top bd-navbar" id="navbar-main">
<div class="container-xl">

    <a class="navbar-brand" href="../index.html">
    
      <img src="../_static/darts-logo-trim.png" class="logo" alt="logo" />
    
    </a>
    <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbar-menu" aria-controls="navbar-menu" aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar-menu" class="col-lg-9 collapse navbar-collapse">
      <ul id="navbar-main-elements" class="navbar-nav mr-auto">
        
        
        <li class="nav-item ">
            <a class="nav-link" href="../README.html">Home</a>
        </li>
        
        <li class="nav-item ">
            <a class="nav-link" href="../generated_api/darts.html">API Reference</a>
        </li>
        
        <li class="nav-item active">
            <a class="nav-link" href="../examples.html">Examples</a>
        </li>
        
        
      </ul>


      <form class="bd-search d-flex align-items-center" action="../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search the docs ..." aria-label="Search the docs ..." autocomplete="off" >
</form>
      

      <ul class="navbar-nav">
        
          <li class="nav-item">
            <a class="nav-link" href="https://github.com/unit8co/darts" target="_blank" rel="noopener">
              <span><i class="fab fa-github-square"></i></span>
            </a>
          </li>
        
        
          <li class="nav-item">
            <a class="nav-link" href="https://twitter.com/unit8co" target="_blank" rel="noopener">
              <span><i class="fab fa-twitter-square"></i></span>
            </a>
          </li>
        
      </ul>
    </div>
</div>
    </nav>
    

    <div class="container-xl">
      <div class="row">
          
          <div class="col-12 col-md-3 bd-sidebar"><nav class="bd-links" id="bd-docs-nav" aria-label="Main navigation">

    <div class="bd-toc-item active">
    
  
    <ul class="nav bd-sidenav">
        
        
        
        
        
        
          
        
        
      </ul>
  
  </nav>
          </div>
          

          
          <div class="d-none d-xl-block col-xl-2 bd-toc">
              
<div class="tocsection onthispage pt-5 pb-3">
    <i class="fas fa-list"></i> On this page
</div>

<nav id="bd-toc-nav">
    <ul class="nav section-nav flex-column">
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Read-and-format" class="nav-link">Read and format</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Constructing-TimeSeries-instances-for-training-and-validation" class="nav-link">Constructing TimeSeries instances for training and validation</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Basic-FFT-model" class="nav-link">Basic FFT model</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Improvement-1:-Crop-the-training-set" class="nav-link">Improvement 1: Crop the training set</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Improvement-2:-Filtering-out-low-amplitude-waves" class="nav-link">Improvement 2: Filtering out low-amplitude waves</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#Improvement-3:-Detrending" class="nav-link">Improvement 3: Detrending</a>
        </li>
    
        <li class="nav-item toc-entry toc-h2">
            <a href="#New-Data:-Hourly-Nuclear-Energy-Generation" class="nav-link">New Data: Hourly Nuclear Energy Generation</a>
        </li>
    
    </ul>
</nav>


              
          </div>
          

          
          <main class="col-12 col-md-9 col-xl-7 py-md-5 pl-md-5 pr-md-4 bd-content" role="main">
              
              <div>
                
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt a.copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Fast-Fourier-Transform-Forecasting-Model-(FFT)">
<h1>Fast Fourier Transform Forecasting Model (FFT)<a class="headerlink" href="#Fast-Fourier-Transform-Forecasting-Model-(FFT)" title="Permalink to this headline">¶</a></h1>
<p>The following is a brief demonstration of the FFT forecasting model. This model is especially suited for data that is very seasonal. The datasets chosen for this demonstration were selected accordingly.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="c1"># fix python path if working locally</span>
<span class="kn">from</span> <span class="nn">utils</span> <span class="kn">import</span> <span class="n">fix_pythonpath_if_working_locally</span>
<span class="n">fix_pythonpath_if_working_locally</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="o">%</span><span class="k">load_ext</span> autoreload
<span class="o">%</span><span class="k">autoreload</span> 2
<span class="o">%</span><span class="k">matplotlib</span> inline
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>


<span class="kn">from</span> <span class="nn">darts</span> <span class="kn">import</span> <span class="n">TimeSeries</span>
<span class="kn">from</span> <span class="nn">darts.models</span> <span class="kn">import</span> <span class="p">(</span>
    <span class="n">FFT</span><span class="p">,</span>
    <span class="n">AutoARIMA</span><span class="p">,</span>
    <span class="n">ExponentialSmoothing</span><span class="p">,</span>
    <span class="n">Prophet</span><span class="p">,</span>
    <span class="n">Theta</span>
<span class="p">)</span>
<span class="kn">from</span> <span class="nn">darts.metrics</span> <span class="kn">import</span> <span class="n">mape</span>
<span class="kn">from</span> <span class="nn">darts.utils.missing_values</span> <span class="kn">import</span> <span class="n">fill_missing_values</span>
<span class="kn">from</span> <span class="nn">darts.datasets</span> <span class="kn">import</span> <span class="n">TemperatureDataset</span><span class="p">,</span> <span class="n">AirPassengersDataset</span><span class="p">,</span> <span class="n">EnergyDataset</span>

<span class="kn">import</span> <span class="nn">warnings</span>
<span class="n">warnings</span><span class="o">.</span><span class="n">filterwarnings</span><span class="p">(</span><span class="s2">&quot;ignore&quot;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="n">logging</span><span class="o">.</span><span class="n">disable</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">CRITICAL</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area stderr docutils container">
<div class="highlight"><pre>
Importing plotly failed. Interactive plots will not work.
</pre></div></div>
</div>
<section id="Read-and-format">
<h2>Read and format<a class="headerlink" href="#Read-and-format" title="Permalink to this headline">¶</a></h2>
<p>Here we simply read the CSV file containing daily temperatures, and transform the values into the desired format.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[20]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts</span> <span class="o">=</span> <span class="n">TemperatureDataset</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
</pre></div>
</div>
</div>
</section>
<section id="Constructing-TimeSeries-instances-for-training-and-validation">
<h2>Constructing <code class="docutils literal notranslate"><span class="pre">TimeSeries</span></code> instances for training and validation<a class="headerlink" href="#Constructing-TimeSeries-instances-for-training-and-validation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[21]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ts</span><span class="o">.</span><span class="n">split_after</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;19850701&#39;</span><span class="p">))</span>
<span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_6_0.png" src="../_images/examples_04-FFT-examples_6_0.png" />
</div>
</div>
</section>
<section id="Basic-FFT-model">
<h2>Basic FFT model<a class="headerlink" href="#Basic-FFT-model" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[25]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FFT</span><span class="p">(</span><span class="n">required_matches</span><span class="o">=</span><span class="nb">set</span><span class="p">(),</span> <span class="n">nr_freqs_to_keep</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
             0
1985-07-02 NaN
1985-07-03 NaN
1985-07-04 NaN
1985-07-05 NaN
1985-07-06 NaN
...         ..
1990-12-27 NaN
1990-12-28 NaN
1990-12-29 NaN
1990-12-30 NaN
1990-12-31 NaN

[2009 rows x 1 columns]
Freq: D
</pre></div></div>
</div>
<p>The plot below shows us that a simple DFT with a random train-test split will most likely lead to bad results. Upon closer inspection we can see that the prediction (in purple) simply repeats the training set (blue). This is the standard behavior of the DFT, and by itself it is quite useless, since repeating our training set could be done much more efficiently. Three improvements were made to this approach.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[23]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE:&quot;</span><span class="p">,</span> <span class="n">mape</span><span class="p">(</span><span class="n">pred_val</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE: nan
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_10_1.png" src="../_images/examples_04-FFT-examples_10_1.png" />
</div>
</div>
</section>
<section id="Improvement-1:-Crop-the-training-set">
<h2>Improvement 1: Crop the training set<a class="headerlink" href="#Improvement-1:-Crop-the-training-set" title="Permalink to this headline">¶</a></h2>
<p>The first improvement consists of cropping the training set before feeding it to the FFT algorithm such that the first timestamp in the cropped series matches the first timestamp to be predicted in terms of seasonality, i.e. it has the same month, day, weekday, time of day, etc. We could achieve this by passing the optional argument <code class="docutils literal notranslate"><span class="pre">required_matches</span></code> to the FFT constructor that explicitly tells our model which timestamp attributes are relevant. But actually, if we don’t set it manually, the
model will attempt to automatically find the pd.Timestamp attributes that are relevant and crop the training set accordingly (which we will do here).</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FFT</span><span class="p">(</span><span class="n">nr_freqs_to_keep</span><span class="o">=</span><span class="kc">None</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>We can see that the results look like the seasonality of the predictions nicely aligns with the seasonality of the validation set. However, we are still just repeating the training set, including all of the noise. Looking at the error we can see that this is still a pretty bad forecast.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE:&quot;</span><span class="p">,</span> <span class="n">mape</span><span class="p">(</span><span class="n">pred_val</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
MAPE: nan
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_14_1.png" src="../_images/examples_04-FFT-examples_14_1.png" />
</div>
</div>
</section>
<section id="Improvement-2:-Filtering-out-low-amplitude-waves">
<h2>Improvement 2: Filtering out low-amplitude waves<a class="headerlink" href="#Improvement-2:-Filtering-out-low-amplitude-waves" title="Permalink to this headline">¶</a></h2>
<p>The decomposition of the DFT into the frequency domain allows us to selectively filter out waves with low amplitudes. This allows us to keep strong seasonal trends while discarding some noise. This is achieved in the FFT model by passing the optional argument <code class="docutils literal notranslate"><span class="pre">nr_freqs_to_keep</span></code>. This argument represents the total number of frequencies that will be kept. For instance, if a value of 20 is passed, only the 20 frequencies with the highest amplitudes will be utilized. The default value is set to
10.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FFT</span><span class="p">(</span><span class="n">nr_freqs_to_keep</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
            #Passengers           0
1956-01-01          284  173.742530
1956-02-01          277  144.396160
1956-03-01          317  138.462730
1956-04-01          313  120.252093
1956-05-01          318  103.180017
1956-06-01          374  120.744737
1956-07-01          413  147.431682
1956-08-01          405  153.423451
1956-09-01          355  137.392169
1956-10-01          306  114.550907
1956-11-01          271  114.355890
1956-12-01          306  126.487990
1957-01-01          315  119.827053
1957-02-01          301  118.838696
1957-03-01          356  135.261790
1957-04-01          348  132.543617
1957-05-01          355  124.277515
1957-06-01          422  145.020211
1957-07-01          465  170.914177
1957-08-01          467  174.048510
1957-09-01          404  154.899844
1957-10-01          347  130.090437
1957-11-01          305  129.901170
1957-12-01          336  144.191883
1958-01-01          340  141.441516
1958-02-01          318  145.303241
1958-03-01          362  166.521089
1958-04-01          348  167.605013
1958-05-01          363  161.470996
1958-06-01          435  182.386265
1958-07-01          491  206.625397
1958-08-01          505  206.771771
1958-09-01          404  184.025743
1958-10-01          359  155.790469
1958-11-01          310  153.012929
1958-12-01          337  165.969924
1959-01-01          360  163.238634
1959-02-01          342  168.258532
1959-03-01          406  191.325454
1959-04-01          396  194.393689
1959-05-01          420  189.861330
1959-06-01          472  211.644510
1959-07-01          548  235.916488
1959-08-01          559  235.427291
1959-09-01          463  211.761749
1959-10-01          407  182.818972
1959-11-01          362  180.016022
1959-12-01          405  193.938015
1960-01-01          417  193.206813
1960-02-01          391  201.000516
1960-03-01          419  227.076955
1960-04-01          461  232.673566
1960-05-01          472  229.439851
1960-06-01          535  250.677394
1960-07-01          622  272.227468
1960-08-01          606  266.888493
1960-09-01          508  236.697492
1960-10-01          461  200.350122
1960-11-01          390  190.271007
1960-12-01          432  198.081697
Freq: MS
</pre></div></div>
</div>
<p>We get a signal that is less noisy. Depending on the data set, this might be a better forecast. Looking at the error metric, we can see that this model performs significantly better than the previous models.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;MAPE:&quot;</span><span class="p">,</span> <span class="n">mape</span><span class="p">(</span><span class="n">pred_val</span><span class="p">,</span> <span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
<span class="ansi-red-fg">---------------------------------------------------------------------------</span>
<span class="ansi-red-fg">ValueError</span>                                Traceback (most recent call last)
<span class="ansi-green-fg">&lt;ipython-input-12-c1535da949de&gt;</span> in <span class="ansi-cyan-fg">&lt;module&gt;</span>
<span class="ansi-green-intense-fg ansi-bold">      2</span> val<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      3</span> pred_val<span class="ansi-blue-fg">.</span>plot<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">----&gt; 4</span><span class="ansi-red-fg"> </span>print<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;MAPE:&#34;</span><span class="ansi-blue-fg">,</span> mape<span class="ansi-blue-fg">(</span>pred_val<span class="ansi-blue-fg">,</span> val<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">      5</span> print<span class="ansi-blue-fg">(</span>pred_val<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/metrics/metrics.py</span> in <span class="ansi-cyan-fg">wrapper_multivariate_support</span><span class="ansi-blue-fg">(*args, **kwargs)</span>
<span class="ansi-green-intense-fg ansi-bold">     38</span>         value_list <span class="ansi-blue-fg">=</span> <span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">]</span>
<span class="ansi-green-intense-fg ansi-bold">     39</span>         <span class="ansi-green-fg">for</span> i <span class="ansi-green-fg">in</span> range<span class="ansi-blue-fg">(</span>series1<span class="ansi-blue-fg">.</span>width<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">---&gt; 40</span><span class="ansi-red-fg">             value_list.append(func(series1.univariate_component(i), series2.univariate_component(i),
</span><span class="ansi-green-intense-fg ansi-bold">     41</span>                               *args[num_series_in_args:], **kwargs))
<span class="ansi-green-intense-fg ansi-bold">     42</span>         <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">&#39;reduction&#39;</span> <span class="ansi-green-fg">in</span> kwargs<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/metrics/metrics.py</span> in <span class="ansi-cyan-fg">mape</span><span class="ansi-blue-fg">(actual_series, pred_series, intersect, reduction)</span>
<span class="ansi-green-intense-fg ansi-bold">    297</span>     &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    298</span>
<span class="ansi-green-fg">--&gt; 299</span><span class="ansi-red-fg">     </span>y_true<span class="ansi-blue-fg">,</span> y_hat <span class="ansi-blue-fg">=</span> _get_values_or_raise<span class="ansi-blue-fg">(</span>actual_series<span class="ansi-blue-fg">,</span> pred_series<span class="ansi-blue-fg">,</span> intersect<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    300</span>     y_true<span class="ansi-blue-fg">,</span> y_hat <span class="ansi-blue-fg">=</span> _remove_nan_union<span class="ansi-blue-fg">(</span>y_true<span class="ansi-blue-fg">,</span> y_hat<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    301</span>     raise_if_not<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">(</span>y_true <span class="ansi-blue-fg">!=</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>all<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;The actual series must be strictly positive to compute the MAPE.&#39;</span><span class="ansi-blue-fg">,</span> logger<span class="ansi-blue-fg">)</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/metrics/metrics.py</span> in <span class="ansi-cyan-fg">_get_values_or_raise</span><span class="ansi-blue-fg">(series_a, series_b, intersect)</span>
<span class="ansi-green-intense-fg ansi-bold">     58</span>                  logger)
<span class="ansi-green-intense-fg ansi-bold">     59</span>
<span class="ansi-green-fg">---&gt; 60</span><span class="ansi-red-fg">     </span>series_a_common <span class="ansi-blue-fg">=</span> series_a<span class="ansi-blue-fg">.</span>slice_intersect<span class="ansi-blue-fg">(</span>series_b<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> intersect <span class="ansi-green-fg">else</span> series_a
<span class="ansi-green-intense-fg ansi-bold">     61</span>     series_b_common <span class="ansi-blue-fg">=</span> series_b<span class="ansi-blue-fg">.</span>slice_intersect<span class="ansi-blue-fg">(</span>series_a<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">if</span> intersect <span class="ansi-green-fg">else</span> series_b
<span class="ansi-green-intense-fg ansi-bold">     62</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/timeseries.py</span> in <span class="ansi-cyan-fg">slice_intersect</span><span class="ansi-blue-fg">(self, other)</span>
<span class="ansi-green-intense-fg ansi-bold">    522</span>         &#34;&#34;&#34;
<span class="ansi-green-intense-fg ansi-bold">    523</span>         time_index <span class="ansi-blue-fg">=</span> self<span class="ansi-blue-fg">.</span>time_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">.</span>intersection<span class="ansi-blue-fg">(</span>other<span class="ansi-blue-fg">.</span>time_index<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">--&gt; 524</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> self<span class="ansi-blue-fg">.</span>__getitem__<span class="ansi-blue-fg">(</span>time_index<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    525</span>
<span class="ansi-green-intense-fg ansi-bold">    526</span>     <span class="ansi-green-fg">def</span> get_timestamp_at_point<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">,</span> point<span class="ansi-blue-fg">:</span> Union<span class="ansi-blue-fg">[</span>pd<span class="ansi-blue-fg">.</span>Timestamp<span class="ansi-blue-fg">,</span> float<span class="ansi-blue-fg">,</span> int<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">-&gt;</span> pd<span class="ansi-blue-fg">.</span>Timestamp<span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/timeseries.py</span> in <span class="ansi-cyan-fg">__getitem__</span><span class="ansi-blue-fg">(self, key)</span>
<span class="ansi-green-intense-fg ansi-bold">   1593</span>             <span class="ansi-green-fg">if</span> <span class="ansi-green-fg">not</span> np<span class="ansi-blue-fg">.</span>all<span class="ansi-blue-fg">(</span>check<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1594</span>                 raise_log<span class="ansi-blue-fg">(</span>IndexError<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;None of {} in the index&#34;</span><span class="ansi-blue-fg">.</span>format<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">~</span>check<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">,</span> logger<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">-&gt; 1595</span><span class="ansi-red-fg">             </span><span class="ansi-green-fg">return</span> use_loc<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1596</span>         <span class="ansi-green-fg">elif</span> isinstance<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">,</span> slice<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">   1597</span>             <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">.</span>start<span class="ansi-blue-fg">,</span> str<span class="ansi-blue-fg">)</span> <span class="ansi-green-fg">or</span> isinstance<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">.</span>stop<span class="ansi-blue-fg">,</span> str<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/timeseries.py</span> in <span class="ansi-cyan-fg">use_loc</span><span class="ansi-blue-fg">(key, col_indexing)</span>
<span class="ansi-green-intense-fg ansi-bold">   1587</span>                 <span class="ansi-green-fg">return</span> TimeSeries<span class="ansi-blue-fg">.</span>from_dataframe<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_df<span class="ansi-blue-fg">.</span>loc<span class="ansi-blue-fg">[</span><span class="ansi-blue-fg">:</span><span class="ansi-blue-fg">,</span> key<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> freq<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>freq_str<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1588</span>             <span class="ansi-green-fg">else</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-fg">-&gt; 1589</span><span class="ansi-red-fg">                 </span><span class="ansi-green-fg">return</span> TimeSeries<span class="ansi-blue-fg">.</span>from_dataframe<span class="ansi-blue-fg">(</span>self<span class="ansi-blue-fg">.</span>_df<span class="ansi-blue-fg">.</span>loc<span class="ansi-blue-fg">[</span>key<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> freq<span class="ansi-blue-fg">=</span>self<span class="ansi-blue-fg">.</span>freq_str<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">   1590</span>
<span class="ansi-green-intense-fg ansi-bold">   1591</span>         <span class="ansi-green-fg">if</span> isinstance<span class="ansi-blue-fg">(</span>key<span class="ansi-blue-fg">,</span> pd<span class="ansi-blue-fg">.</span>DatetimeIndex<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/timeseries.py</span> in <span class="ansi-cyan-fg">from_dataframe</span><span class="ansi-blue-fg">(df, time_col, value_cols, freq, fill_missing_dates, dummy_index)</span>
<span class="ansi-green-intense-fg ansi-bold">    799</span>                 series_df<span class="ansi-blue-fg">.</span>index <span class="ansi-blue-fg">=</span> pd<span class="ansi-blue-fg">.</span>to_datetime<span class="ansi-blue-fg">(</span>df<span class="ansi-blue-fg">[</span>time_col<span class="ansi-blue-fg">]</span><span class="ansi-blue-fg">,</span> errors<span class="ansi-blue-fg">=</span><span class="ansi-blue-fg">&#39;raise&#39;</span><span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    800</span>
<span class="ansi-green-fg">--&gt; 801</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">return</span> TimeSeries<span class="ansi-blue-fg">(</span>series_df<span class="ansi-blue-fg">,</span> freq<span class="ansi-blue-fg">,</span> fill_missing_dates<span class="ansi-blue-fg">,</span> dummy_index<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">    802</span>
<span class="ansi-green-intense-fg ansi-bold">    803</span>     <span class="ansi-blue-fg">@</span>staticmethod

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/timeseries.py</span> in <span class="ansi-cyan-fg">__init__</span><span class="ansi-blue-fg">(self, df, freq, fill_missing_dates, dummy_index)</span>
<span class="ansi-green-intense-fg ansi-bold">     51</span>         raise_if_not(isinstance(df, pd.DataFrame), &#34;Data must be provided in form of a pandas.DataFrame instance&#34;,
<span class="ansi-green-intense-fg ansi-bold">     52</span>                      logger)
<span class="ansi-green-fg">---&gt; 53</span><span class="ansi-red-fg">         </span>raise_if_not<span class="ansi-blue-fg">(</span>len<span class="ansi-blue-fg">(</span>df<span class="ansi-blue-fg">)</span> <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span> <span class="ansi-green-fg">and</span> df<span class="ansi-blue-fg">.</span>shape<span class="ansi-blue-fg">[</span><span class="ansi-cyan-fg">1</span><span class="ansi-blue-fg">]</span> <span class="ansi-blue-fg">&gt;</span> <span class="ansi-cyan-fg">0</span><span class="ansi-blue-fg">,</span> <span class="ansi-blue-fg">&#39;Time series must not be empty.&#39;</span><span class="ansi-blue-fg">,</span> logger<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     54</span>         raise_if_not(df.dtypes.apply(lambda x: np.issubdtype(x, np.number)).all(), &#39;Time series must&#39;
<span class="ansi-green-intense-fg ansi-bold">     55</span>                      &#39; contain only numerical values.&#39;, logger)

<span class="ansi-green-fg">~/Documents/unit8/cx/Darts/darts/darts/logging.py</span> in <span class="ansi-cyan-fg">raise_if_not</span><span class="ansi-blue-fg">(condition, message, logger)</span>
<span class="ansi-green-intense-fg ansi-bold">     52</span>     <span class="ansi-green-fg">if</span> <span class="ansi-blue-fg">(</span><span class="ansi-green-fg">not</span> condition<span class="ansi-blue-fg">)</span><span class="ansi-blue-fg">:</span>
<span class="ansi-green-intense-fg ansi-bold">     53</span>         logger<span class="ansi-blue-fg">.</span>error<span class="ansi-blue-fg">(</span><span class="ansi-blue-fg">&#34;ValueError: &#34;</span> <span class="ansi-blue-fg">+</span> message<span class="ansi-blue-fg">)</span>
<span class="ansi-green-fg">---&gt; 54</span><span class="ansi-red-fg">         </span><span class="ansi-green-fg">raise</span> ValueError<span class="ansi-blue-fg">(</span>message<span class="ansi-blue-fg">)</span>
<span class="ansi-green-intense-fg ansi-bold">     55</span>
<span class="ansi-green-intense-fg ansi-bold">     56</span>

<span class="ansi-red-fg">ValueError</span>: Time series must not be empty.
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_18_1.png" src="../_images/examples_04-FFT-examples_18_1.png" />
</div>
</div>
</section>
<section id="Improvement-3:-Detrending">
<h2>Improvement 3: Detrending<a class="headerlink" href="#Improvement-3:-Detrending" title="Permalink to this headline">¶</a></h2>
<p>Let’s try out a different data set that has a global upward trend</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts_2</span> <span class="o">=</span> <span class="n">AirPassengersDataset</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ts_2</span><span class="o">.</span><span class="n">split_after</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;19551201&#39;</span><span class="p">))</span>
<span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_20_0.png" src="../_images/examples_04-FFT-examples_20_0.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FFT</span><span class="p">()</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>Clearly, our model fails completely at incorporating the upward trend. Due to the trend, our model also fails to recognize the monthly seasonality.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_23_0.png" src="../_images/examples_04-FFT-examples_23_0.png" />
</div>
</div>
<p>This problem can be solved by setting the optional trend argument to either ‘poly’ or ‘exp’, which fits a polynomial or exponential funtion to the data and subtracts it before moving on to DFT. When predicting, the trend is added again.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">model</span> <span class="o">=</span> <span class="n">FFT</span><span class="p">(</span><span class="n">trend</span><span class="o">=</span><span class="s1">&#39;poly&#39;</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
<span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
</pre></div>
</div>
</div>
<p>We have a much better prediction now.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">pred_val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_27_0.png" src="../_images/examples_04-FFT-examples_27_0.png" />
</div>
</div>
</section>
<section id="New-Data:-Hourly-Nuclear-Energy-Generation">
<h2>New Data: Hourly Nuclear Energy Generation<a class="headerlink" href="#New-Data:-Hourly-Nuclear-Energy-Generation" title="Permalink to this headline">¶</a></h2>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">ts_3</span> <span class="o">=</span> <span class="n">EnergyDataset</span><span class="o">.</span><span class="n">load</span><span class="p">()</span>
<span class="n">ts_3</span> <span class="o">=</span> <span class="n">fill_missing_values</span><span class="p">(</span><span class="n">ts_3</span><span class="p">,</span> <span class="s1">&#39;auto&#39;</span><span class="p">)</span>
<span class="n">ts_3</span> <span class="o">=</span> <span class="n">ts_3</span><span class="p">[</span><span class="s1">&#39;generation nuclear&#39;</span><span class="p">]</span>
<span class="n">train</span><span class="p">,</span> <span class="n">val</span> <span class="o">=</span> <span class="n">ts_3</span><span class="o">.</span><span class="n">split_after</span><span class="p">(</span><span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="p">(</span><span class="s1">&#39;2017-07-01&#39;</span><span class="p">))</span>
<span class="n">train</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
<span class="n">val</span><span class="o">.</span><span class="n">plot</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="../_images/examples_04-FFT-examples_29_0.png" src="../_images/examples_04-FFT-examples_29_0.png" />
</div>
</div>
<p>Instead of simply looking at the performance of the FFT model, we can also look at how a bunch of other forecasting models performs on this new data set in terms of MAPE. Surprisingly, on this dataset, the FFT model outperforms all of the others (at least with their default parameters). Granted, this dataset was specifically chosen because of its highly seasonal nature. However, this shows us that there definitely are use cases for FFT. Furthermore, the FFT model has a much shorter running time
than the other models!</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[17]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre>
<span></span><span class="n">models</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">AutoARIMA</span><span class="p">(),</span>
    <span class="n">Prophet</span><span class="p">(),</span>
    <span class="n">ExponentialSmoothing</span><span class="p">(),</span>
    <span class="n">Theta</span><span class="p">(),</span>
    <span class="n">FFT</span><span class="p">()</span>
<span class="p">]</span>

<span class="k">for</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="p">:</span>
    <span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">train</span><span class="p">)</span>
    <span class="n">pred_val</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">val</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">model</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; MAPE: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">mape</span><span class="p">(</span><span class="n">pred_val</span><span class="p">,</span> <span class="n">val</span><span class="p">)))</span>

</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Auto-ARIMA MAPE: 13.46753956256134
Prophet MAPE: 10.773018989608806
Exponential smoothing MAPE: 17.849425318793447
Theta(2) MAPE: 13.330007725418852
FFT(nr_freqs_to_keep=10, trend=None) MAPE: 10.263184839655274
</pre></div></div>
</div>
</section>
</section>


              </div>
              
              
              <div class='prev-next-bottom'>
                
    <a class='left-prev' id="prev-link" href="03-data-processing.html" title="previous page">Data (pre) processing using <code class="docutils literal notranslate"><span class="pre">DataTransformer</span></code> and <code class="docutils literal notranslate"><span class="pre">Pipeline</span></code></a>
    <a class='right-next' id="next-link" href="05-RNN-examples.html" title="next page">Recurrent Neural Networks Models</a>

              </div>
              
          </main>
          

      </div>
    </div>

    
  <script src="../_static/js/index.3da636dd464baa7582d2.js"></script>


    <footer class="footer mt-5 mt-md-0">
  <div class="container">
    <p>
          &copy; Copyright 2021, Unit8 SA.<br/>
        Created using <a href="http://sphinx-doc.org/">Sphinx</a> 3.2.1.<br/>
    </p>
  </div>
</footer>
  </body>
</html>